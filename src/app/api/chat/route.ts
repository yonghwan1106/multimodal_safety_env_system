export const maxDuration = 30;

// ?œë‚˜ë¦¬ì˜¤ë³?ëª©ì—… ?‘ë‹µ
const mockResponses: Record<string, string> = {
  "ê°€??: `?š¨ ê¸´ê¸‰: Dêµ¬ì—­ ê°€???„ì¶œ ?€??ì§€ì¹?*

ì¦‰ê° ì¡°ì¹˜?¬í•­:
1. Dêµ¬ì—­ ??ëª¨ë“  ?‘ì—…??ì¦‰ì‹œ ?€??(ë¹„ìƒêµ? ë¶ì¸¡ ì¶œì…ë¬?
2. ì¤‘ì•™ê´€?œì‹¤ ?°ë½ (?´ì„  100)
3. ê°€??ì°¨ë‹¨ ë°¸ë¸Œ ?•ì¸ ë°?ì°¨ë‹¨

?ˆì „ ?¥ë¹„:
- ë°©ë…ë©?ì°©ìš© ?„ìˆ˜
- ?•ì „ê¸?ë°©ì? ?¥ê°‘ ì°©ìš©
- ?”ê¸° ?¬ìš© ê¸ˆì?

?€??ê²½ë¡œ:
Dêµ¬ì—­ ??ë¶ì¸¡ ë¹„ìƒêµ???Eêµ¬ì—­ ì§‘ê²°ì§€

?°ë½ì²?
- ì¤‘ì•™ê´€?œì‹¤: ?´ì„  100
- ?Œë°©?? 119
- ?ˆì „ê´€ë¦¬í?: ?´ì„  200`,

  "?”ì¬": `?”¥ ê¸´ê¸‰: Bêµ¬ì—­ ?”ì¬ ?€??ì§€ì¹?*

ì¦‰ê° ì¡°ì¹˜?¬í•­:
1. ?”ì¬ ê²½ë³´ ë°œë ¹
2. Bêµ¬ì—­ ?„ì› ì°¨ë‹¨
3. ì´ˆê¸° ì§„í™” ?œë„ (?Œí™”ê¸??¬ìš©)
4. ì§„í™” ë¶ˆê? ??ì¦‰ì‹œ ?€??

?€??ê²½ë¡œ:
Bêµ¬ì—­ ?°ë¹ˆ?????œì¸¡ ë¹„ìƒê³„ë‹¨ ??1ì¸??•ë¬¸ ??ì£¼ì°¨??ì§‘ê²°ì§€

?Œí™”ê¸??„ì¹˜:
- ?°ë¹ˆ??1ì¸??…êµ¬ (ë¶„ë§?Œí™”ê¸?
- ?œì–´???´ë? (CO2 ?Œí™”ê¸?
- ë¹„ìƒê³„ë‹¨ ?…êµ¬ (ë¶„ë§?Œí™”ê¸?

?°ë½ì²?
- ?Œë°©?? 119
- ì¤‘ì•™ê´€?œì‹¤: ?´ì„  100
- ?˜ë£Œ?€: ?´ì„  119`,

  "?°ëŸ¬": `?¥ ê¸´ê¸‰: Cêµ¬ì—­ ?‘ì—…???‘ê¸‰?í™© ?€??ì§€ì¹?*

ì¦‰ê° ì¡°ì¹˜?¬í•­:
1. ?˜ë£Œ?€ ?¸ì¶œ (?´ì„  119)
2. ?˜ì ?íƒœ ?•ì¸ (?˜ì‹, ?¸í¡, ë§¥ë°•)
3. ê¸°ë„ ?•ë³´ ë°??ˆì •???ì„¸ ? ì?
4. AED ì¤€ë¹?(Cêµ¬ì—­ ?…êµ¬ ë²½ë©´)

?‘ê¸‰ì²˜ì¹˜:
- ?˜ì‹ ?†ìŒ: ?Œë³µ ?ì„¸ë¡??„í™˜
- ?¸í¡ ?†ìŒ: ?¬í?Œìƒ??CPR) ?œì‘
- ì¶œí˜ˆ ?? ì§ì ‘ ?•ë°• ì§€??

AED ?„ì¹˜:
Cêµ¬ì—­ ë³€?„ì„¤ë¹??…êµ¬ ë²½ë©´ (ë¹¨ê°„????

?°ë½ì²?
- ?˜ë£Œ?€: ?´ì„  119
- 119 êµ¬ê¸‰?€: 119
- ?ˆì „ê´€ë¦¬í?: ?´ì„  200`,

  "?ˆì „ëª?: `?‘ï¸ ì£¼ì˜: Aêµ¬ì—­ ?ˆì „ëª?ë¯¸ì°©???€??ì§€ì¹?*

ì¦‰ê° ì¡°ì¹˜?¬í•­:
1. ?´ë‹¹ ?‘ì—…???•ì¸ ë°??ˆì „ëª?ì°©ìš© ?ˆë‚´
2. ?ˆì „ëª?ë¯¸ë¹„ ???¬ë¶„ ì§€ê¸?
3. ë°˜ë³µ ?„ë°˜ ???ˆì „êµìœ¡ ê¶Œì¥

?ˆì „ëª?ë¹„ì¹˜ ?„ì¹˜:
- Aêµ¬ì—­ ?…êµ¬ ?ˆì „?¥ë¹„??
- ê´€ë¦¬ë™ ?ˆì „ê´€ë¦¬ì‹¤

ê´€??ê·œì •:
- ?°ì—…?ˆì „ë³´ê±´ë²???2ì¡?
- ?¬ë‚´ ?ˆì „?˜ì¹™ ??ì¡?

ê¶Œê³ ?¬í•­:
- ?‘ì—… ???ˆì „?¥ë¹„ ?ê? ?µê???
- ?ˆì „ëª??±ëˆ ë°˜ë“œ??ì²´ê²°

?°ë½ì²?
- ?ˆì „ê´€ë¦¬í?: ?´ì„  200`,
};

// ê¸°ë³¸ ?‘ë‹µ
const defaultResponse = `?“‹ AI ?ˆì „ ê°€?´ë“œ ?‘ë‹µ

ì§ˆë¬¸??ë¶„ì„?ˆìŠµ?ˆë‹¤. ?„ë˜ ?•ë³´ë¥?ì°¸ê³ ?´ì£¼?¸ìš”.

ë°œì „??êµ¬ì—­ ?•ë³´:
- Aêµ¬ì—­: ë³´ì¼?¬ë™
- Bêµ¬ì—­: ?°ë¹ˆ??
- Cêµ¬ì—­: ë³€?„ì„¤ë¹?
- Dêµ¬ì—­: ?°ë£Œ?€??
- Eêµ¬ì—­: ?‰ê°??
- Fêµ¬ì—­: ê´€ë¦¬ë™

ê¸´ê¸‰ ?°ë½ì²?
- ì¤‘ì•™ê´€?œì‹¤: ?´ì„  100
- ?Œë°©?? 119
- ?˜ë£Œ?€: ?´ì„  119
- ?ˆì „ê´€ë¦¬í?: ?´ì„  200

êµ¬ì²´?ì¸ ?í™©(ê°€???„ì¶œ, ?”ì¬, ?‘ì—…???°ëŸ¬ì§? ?ˆì „ëª?ë¯¸ì°©??????ë§ì??´ì£¼?œë©´ ???•í™•???€??ì§€ì¹¨ì„ ?ˆë‚´?´ë“œë¦½ë‹ˆ??`;

function getMockResponse(message: string): string {
  const lowerMessage = message.toLowerCase();

  if (lowerMessage.includes("ê°€??) || lowerMessage.includes("?„ì¶œ")) {
    return mockResponses["ê°€??];
  }
  if (lowerMessage.includes("?”ì¬") || lowerMessage.includes("?°ê¸°") || lowerMessage.includes("ë¶?)) {
    return mockResponses["?”ì¬"];
  }
  if (lowerMessage.includes("?°ëŸ¬") || lowerMessage.includes("?‘ê¸‰") || lowerMessage.includes("?˜ì‹")) {
    return mockResponses["?°ëŸ¬"];
  }
  if (lowerMessage.includes("?ˆì „ëª?) || lowerMessage.includes("?¬ë©§") || lowerMessage.includes("ë¯¸ì°©??)) {
    return mockResponses["?ˆì „ëª?];
  }

  return defaultResponse;
}

export async function POST(req: Request) {
  const { messages } = await req.json();
  const lastMessage = messages[messages.length - 1];

  // ëª©ì—… ?‘ë‹µ ?ì„±
  const response = getMockResponse(lastMessage.content);

  // ?¤íŠ¸ë¦¬ë° ?•ì‹?¼ë¡œ ?‘ë‹µ (ê¸€???¨ìœ„ë¡??„ì†¡)
  const encoder = new TextEncoder();
  const stream = new ReadableStream({
    async start(controller) {
      // ?‘ë‹µ??ì²?¬ ?¨ìœ„ë¡??„ì†¡
      const chunks = response.split("");
      for (let i = 0; i < chunks.length; i += 3) {
        const chunk = chunks.slice(i, i + 3).join("");
        controller.enqueue(encoder.encode(`0:${JSON.stringify(chunk)}
`));
        await new Promise(resolve => setTimeout(resolve, 10)); // ?ì—°?¤ëŸ¬???€?´í•‘ ?¨ê³¼
      }
      controller.close();
    },
  });

  return new Response(stream, {
    headers: {
      "Content-Type": "text/plain; charset=utf-8",
      "Transfer-Encoding": "chunked",
    },
  });
}
